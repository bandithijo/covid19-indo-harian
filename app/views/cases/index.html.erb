<div class="container is-fluid">
  <table class="table is-bordered is-hoverable is-fullwidth-mobile" id="table-case">
    <thead>
      <tr>
        <th class="is-hidden-mobile">No.</th>
        <th>Tanggal</th>
        <th>Total Kasus</th>
        <th>Kasus<br><span class="nobr">(Hari ini)</span></th>
        <th class="is-hidden-mobile">Meninggal</th>
        <th class="is-hidden-mobile">Meninggal<br><span class="nobr">(Hari ini)</span></th>
        <th class="is-hidden-mobile">Sembuh</th>
        <th class="is-hidden-mobile">Sembuh<br><span class="nobr">(Hari ini)</span></th>
        <th class="is-hidden-mobile">ODP</th>
        <th class="is-hidden-mobile">ODP<br><span class="nobr">(Hari ini)</span></th>
        <th class="is-hidden-mobile">PDP</th>
        <th class="is-hidden-mobile">PDP<br><span class="nobr">(Hari ini)</span></th>
        <th class="is-hidden-mobile">Aktif</th>
      </tr>
    </thead>
    <tbody>
      <% @cases.each.with_index(1) do |kasus, index| %>
        <% positif_covid_kemarin   = @cases[index-2].positif_covid %>
        <% meninggal_covid_kemarin = @cases[index-2].meninggal_covid %>
        <% sembuh_covid_kemarin    = @cases[index-2].sembuh_covid %>
        <% jumlah_odp_kemarin      = @cases[index-2].jumlah_odp %>
        <% jumlah_pdp_kemarin      = @cases[index-2].jumlah_pdp %>
        <tr>
          <td class="has-text-left is-hidden-mobile">
            <% if index == @cases.last.id %>
              <span class="has-background-warning"><b><%= index %></b></span>
            <% else %>
              <%= index %>
            <% end %>
          </td>
          <td class="has-text-centered">
            <% if kasus.fetched_at == @cases.last.fetched_at %>
              <span class="nobr has-background-warning"><b><%= kasus.fetched_at %></b></span>
            <% else %>
              <span class="nobr"><%= kasus.fetched_at %></span>
            <% end %>
          </td>
          <td class="has-text-right">
            <% if kasus.positif_covid == @cases.last.positif_covid %>
              <span class="has-background-warning"><b><%= number_with_delimiter(kasus.positif_covid) %></b></span>
            <% else %>
              <%= number_with_delimiter(kasus.positif_covid) %>
            <% end %>
          </td>
          <td class="has-text-right">
            <% if kasus.positif_covid == @cases.last.positif_covid %>
              <span class="has-background-warning"><b><%= number_with_delimiter(index == 1 ? 0 : kasus.positif_covid.to_i - positif_covid_kemarin.to_i) %></b></span>
            <% else %>
              <%= number_with_delimiter(index == 1 ? 0 : kasus.positif_covid.to_i - positif_covid_kemarin.to_i) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.meninggal_covid == @cases.last.meninggal_covid %>
              <span class="has-background-warning"><b><%= number_with_delimiter(kasus.meninggal_covid) %></b></span>
            <% else %>
              <%= number_with_delimiter(kasus.meninggal_covid) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.meninggal_covid == @cases.last.meninggal_covid %>
              <span class="has-background-warning"><b><%= number_with_delimiter(index == 1 ? 0 : kasus.meninggal_covid.to_i - meninggal_covid_kemarin.to_i) %></b></span>
            <% else %>
              <%= number_with_delimiter(index == 1 ? 0 : kasus.meninggal_covid.to_i - meninggal_covid_kemarin.to_i) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.sembuh_covid == @cases.last.sembuh_covid %>
              <span class="has-background-warning"><b><%= number_with_delimiter(kasus.sembuh_covid) %></b></span>
            <% else %>
              <%= number_with_delimiter(kasus.sembuh_covid) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.sembuh_covid == @cases.last.sembuh_covid %>
              <span class="has-background-warning"><b><%= number_with_delimiter(index == 1 ? 0 : kasus.sembuh_covid.to_i - sembuh_covid_kemarin.to_i) %></b></span>
            <% else %>
              <%= number_with_delimiter(index == 1 ? 0 : kasus.sembuh_covid.to_i - sembuh_covid_kemarin.to_i) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.jumlah_odp == @cases.last.jumlah_odp %>
              <span class="has-background-warning"><b><%= number_with_delimiter(kasus.jumlah_odp) %></b></span>
            <% else %>
              <%= number_with_delimiter(kasus.jumlah_odp) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.jumlah_odp == @cases.last.jumlah_odp %>
              <span class="has-background-warning"><b><%= number_with_delimiter(index == 1 ? 0 : kasus.jumlah_odp.to_i - jumlah_odp_kemarin.to_i) %></b></span>
            <% else %>
              <%= number_with_delimiter(index == 1 ? 0 : kasus.jumlah_odp.to_i - jumlah_odp_kemarin.to_i) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.jumlah_pdp == @cases.last.jumlah_pdp %>
              <span class="has-background-warning"><b><%= number_with_delimiter(kasus.jumlah_pdp) %></b></span>
            <% else %>
              <%= number_with_delimiter(kasus.jumlah_pdp) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.jumlah_pdp == @cases.last.jumlah_pdp %>
              <span class="has-background-warning"><b><%= number_with_delimiter(index == 1 ? 0 : kasus.jumlah_pdp.to_i - jumlah_pdp_kemarin.to_i) %></b></span>
            <% else %>
              <%= number_with_delimiter(index == 1 ? 0 : kasus.jumlah_pdp.to_i - jumlah_pdp_kemarin.to_i) %>
            <% end %>
          </td>
          <td class="has-text-right is-hidden-mobile">
            <% if kasus.positif_covid == @cases.last.positif_covid %>
              <span class="has-background-warning"><b><%= number_with_delimiter(kasus.positif_covid.to_i - (kasus.meninggal_covid + kasus.sembuh_covid)) %></b></span>
            <% else %>
              <%= number_with_delimiter(kasus.positif_covid.to_i - (kasus.meninggal_covid + kasus.sembuh_covid)) %>
            <% end %>
          </td>
        </tr>
      <% end %>
      <script>
        var rows = document.querySelectorAll('#table-case tr');
        rows[<%= @cases.last.id %>].scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
      </script>
    </tbody>
  </table>

  <div class="buttons are-small">
    <%= link_to cases_path(format: "xlsx"), class: "button is-fullwidth-mobile" do %>
      <span class="icon">
        <%= image_tag 'file-download-solid.svg', width: '12' %>
      </span>
      <span class="has-text-weight-normal">Export as SpreadSheet</span>
    <% end %>

    <%= link_to cases_path(format: "csv"), class: "button is-fullwidth-mobile" do %>
      <span class="icon">
        <%= image_tag 'file-download-solid.svg', width: '12' %>
      </span>
      <span class="has-text-weight-normal">Export as CSV</span>
    <% end %>
  </div>

  <div class="is-size-7 is-hidden-desktop is-flex-mobile">
    <b>*Gunakan desktop untuk tampilan tabel yang lebih lengkap.</b>
  </div>

  <div class="legend">
    <h4 class="subtitle is-4">Legenda:</h3>
    <table class="table is-bordered">
      <tr>
        <td class="has-text-right"><b>Tanggal</b></td>
        <td class="has-text-left">Tanggal perhari</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>Total Kasus</b></td>
        <td class="has-text-left">Total kasus baru (akumulasi)</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>Kasus (Hari ini)</b></td>
        <td class="has-text-left">Total kasus baru dalam 24 jam</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>Meninggal</b></td>
        <td class="has-text-left">Total pasien meninggal (akumulasi)</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>Meninggal (Hari ini)</b></td>
        <td class="has-text-left">Total pasien meninggal dalam 24 jam</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>Sembuh</b></td>
        <td class="has-text-left">Total pasien sembuh (akumulasi)</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>Sembuh (Hari ini)</b></td>
        <td class="has-text-left">Total pasien sembuh dalam 24 jam</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>ODP</b></td>
        <td class="has-text-left">Total orang dalam pemantauan (akumulasi)</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>ODP (Hari ini)</b></td>
        <td class="has-text-left">Total orang dalam pemantauan dalam 24 jam</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>PDP</b></td>
        <td class="has-text-left">Total pasien dalam pengawasan (akumulasi)</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>PDP (Hari ini)</b></td>
        <td class="has-text-left">Total pasien dalam pengawasan dalam 24 jam</td>
      </tr>
      <tr>
        <td class="has-text-right"><b>Aktif</b></td>
        <td class="has-text-left">Total kasus yang masih ditangani (TK - (MNGL + SMBH))</td>
      </tr>
    </table>
  </div>
</div>
